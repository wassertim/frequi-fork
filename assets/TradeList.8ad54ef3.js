import{_ as B,o as d,c as w,a as C,t as V,g as T,m as D,d as P,D as j,r as s,j as h,w as c,b as i,f as S,u as H,h as v,i as R,k as G,l as z,x as I,q as W,F as J}from"./index.dc3313a3.js";import{D as Q,T as X}from"./TradeProfit.4185efa5.js";const Y={name:"CloseBoxMultipleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ee=["aria-hidden","aria-label"],te=["fill","width","height"],oe={d:"M4 20H18V22H4C2.9 22 2 21.11 2 20V6H4V20M20.22 2H7.78C6.8 2 6 2.8 6 3.78V16.22C6 17.2 6.8 18 7.78 18H20.22C21.2 18 22 17.2 22 16.22V3.78C22 2.8 21.2 2 20.22 2M19 13.6L17.6 15L14 11.4L10.4 15L9 13.6L12.6 10L9 6.4L10.4 5L14 8.6L17.6 5L19 6.4L15.4 10L19 13.6Z"},ae={key:0};function re(e,t,r,y,_,l){return d(),w("span",D(e.$attrs,{"aria-hidden":!r.title,"aria-label":r.title,class:"material-design-icon close-box-multiple-icon",role:"img",onClick:t[0]||(t[0]=u=>e.$emit("click",u))}),[(d(),w("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[C("path",oe,[r.title?(d(),w("title",ae,V(r.title),1)):T("",!0)])],8,te))],16,ee)}var ie=B(Y,[["render",re]]);const le={name:"GestureTapIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ne=["aria-hidden","aria-label"],se=["fill","width","height"],de={d:"M10,9A1,1 0 0,1 11,8A1,1 0 0,1 12,9V13.47L13.21,13.6L18.15,15.79C18.68,16.03 19,16.56 19,17.14V21.5C18.97,22.32 18.32,22.97 17.5,23H11C10.62,23 10.26,22.85 10,22.57L5.1,18.37L5.84,17.6C6.03,17.39 6.3,17.28 6.58,17.28H6.8L10,19V9M11,5A4,4 0 0,1 15,9C15,10.5 14.2,11.77 13,12.46V11.24C13.61,10.69 14,9.89 14,9A3,3 0 0,0 11,6A3,3 0 0,0 8,9C8,9.89 8.39,10.69 9,11.24V12.46C7.8,11.77 7,10.5 7,9A4,4 0 0,1 11,5Z"},ue={key:0};function me(e,t,r,y,_,l){return d(),w("span",D(e.$attrs,{"aria-hidden":!r.title,"aria-label":r.title,class:"material-design-icon gesture-tap-icon",role:"img",onClick:t[0]||(t[0]=u=>e.$emit("click",u))}),[(d(),w("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[C("path",de,[r.title?(d(),w("title",ue,V(r.title),1)):T("",!0)])],8,se))],16,ne)}var ce=B(le,[["render",me]]);const pe=P({name:"TradeActions",components:{DeleteIcon:j,ForceSellIcon:ie},props:{botApiVersion:{type:Number,default:1},trade:{type:Object,required:!0}},emits:["forceExit","forceExitPartial","deleteTrade"],setup(){return{}}}),fe={class:"d-flex flex-column"};function be(e,t,r,y,_,l){const u=s("ForceSellIcon"),m=s("b-button"),g=s("DeleteIcon");return d(),w("div",fe,[e.botApiVersion<=1.1?(d(),h(m,{key:0,class:"btn-xs text-start",size:"sm",title:"Forceexit",onClick:t[0]||(t[0]=p=>e.$emit("forceExit",e.trade))},{default:c(()=>[i(u,{size:16,title:"Forceexit",class:"me-1"}),S("Forceexit ")]),_:1})):T("",!0),e.botApiVersion>1.1?(d(),h(m,{key:1,class:"btn-xs text-start",size:"sm",title:"Forceexit limit",onClick:t[1]||(t[1]=p=>e.$emit("forceExit",e.trade,"limit"))},{default:c(()=>[i(u,{size:16,title:"Forceexit limit",class:"me-1"}),S("Forceexit limit ")]),_:1})):T("",!0),e.botApiVersion>1.1?(d(),h(m,{key:2,class:"btn-xs text-start mt-1",size:"sm",title:"Forceexit market",onClick:t[2]||(t[2]=p=>e.$emit("forceExit",e.trade,"market"))},{default:c(()=>[i(u,{size:16,title:"Forceexit market",class:"me-1"}),S("Forceexit market ")]),_:1})):T("",!0),e.botApiVersion>2.16?(d(),h(m,{key:3,class:"btn-xs text-start mt-1",size:"sm",title:"Forceexit partial",onClick:t[3]||(t[3]=p=>e.$emit("forceExitPartial",e.trade))},{default:c(()=>[i(u,{size:16,title:"Forceexit partial",class:"me-1"}),S("Forceexit partial ")]),_:1})):T("",!0),i(m,{class:"btn-xs text-start mt-1",size:"sm",title:"Delete trade",onClick:t[4]||(t[4]=p=>e.$emit("deleteTrade",e.trade))},{default:c(()=>[i(g,{size:16,title:"Delete trade",class:"me-1"}),S(" Delete ")]),_:1})])}var ve=B(pe,[["render",be]]);const ye=P({name:"ForceExitForm",props:{trade:{type:Object,required:!0},modelValue:{required:!0,default:!1,type:Boolean}},emits:["update:modelValue"],setup(e,{emit:t}){const r=H(),y=v(),_=v(void 0),l=v("limit"),u=()=>{var $;return($=y.value)==null?void 0:$.checkValidity()},m=R({get(){return e.modelValue},set(f){t("update:modelValue",f)}}),g=()=>{if(!u())return;const f={tradeid:String(e.trade.trade_id)};l.value&&(f.ordertype=l.value),_.value&&(f.amount=_.value),r.activeBot.forceexit(f),m.value=!1};return{handleSubmit:g,botStore:r,form:y,handleEntry:()=>{g()},resetForm:()=>{var f,$,E,F;_.value=e.trade.amount,r.activeBot.botApiVersion>1.1&&(l.value=(($=(f=r.activeBot.botState)==null?void 0:f.order_types)==null?void 0:$.force_exit)||((F=(E=r.activeBot.botState)==null?void 0:E.order_types)==null?void 0:F.exit)||"limit")},amount:_,ordertype:l,model:m}}}),_e=C("br",null,null,-1);function ge(e,t,r,y,_,l){const u=s("b-form-input"),m=s("b-form-group"),g=s("b-form-select"),p=s("b-modal");return d(),w("div",null,[i(p,{id:"forceexit-modal",modelValue:e.model,"onUpdate:modelValue":t[4]||(t[4]=n=>e.model=n),title:"Force exiting a trade",onShow:e.resetForm,onHidden:e.resetForm,onOk:e.handleEntry},{default:c(()=>[C("form",{ref:"form",onSubmit:t[3]||(t[3]=G((...n)=>e.handleSubmit&&e.handleSubmit(...n),["stop","prevent"]))},[C("p",null,[C("span",null,"Exiting Trade #"+V(e.trade.trade_id)+" "+V(e.trade.pair)+".",1),_e,C("span",null,"Currently owning "+V(e.trade.amount)+" "+V(e.trade.base_currency),1)]),e.botStore.activeBot.botApiVersion>1.12?(d(),h(m,{key:0,label:`*Amount in ${e.trade.base_currency} [optional]`,"label-for":"stake-input","invalid-feedback":"Amount must be empty or a positive number",state:e.amount!==void 0&&e.amount>0},{default:c(()=>[i(u,{id:"stake-input",modelValue:e.amount,"onUpdate:modelValue":t[0]||(t[0]=n=>e.amount=n),type:"number",step:"0.000001",onKeydown:z(e.handleEntry,["enter","native"])},null,8,["modelValue","onKeydown"]),i(u,{id:"stake-input",modelValue:e.amount,"onUpdate:modelValue":t[1]||(t[1]=n=>e.amount=n),type:"range",step:"0.000001",min:"0",max:e.trade.amount,onKeydown:z(e.handleEntry,["enter","native"])},null,8,["modelValue","max","onKeydown"])]),_:1},8,["label","state"])):T("",!0),e.botStore.activeBot.botApiVersion>1.1?(d(),h(m,{key:1,label:"*OrderType","label-for":"ordertype-input","invalid-feedback":"OrderType",state:e.ordertype!==void 0},{default:c(()=>[i(g,{modelValue:e.ordertype,"onUpdate:modelValue":t[2]||(t[2]=n=>e.ordertype=n),class:"ms-2",options:["market","limit"],style:{"min-width":"7em"},size:"sm"},null,8,["modelValue"])]),_:1},8,["state"])):T("",!0)],544)]),_:1},8,["modelValue","onShow","onHidden","onOk"])])}var ke=B(ye,[["render",ge]]);const Te=P({name:"TradeList",components:{ActionIcon:ce,DateTimeTZ:Q,TradeProfit:X,TradeActions:ve,ForceExitForm:ke},props:{trades:{required:!0,type:Array},title:{default:"Trades",type:String},stakeCurrency:{required:!1,default:"",type:String},activeTrades:{default:!1,type:Boolean},showFilter:{default:!1,type:Boolean},multiBotView:{default:!1,type:Boolean},emptyText:{default:"No Trades to show.",type:String}},setup(e){const t=H(),r=v(1),y=v(),_=v(""),l=v({}),u=e.activeTrades?200:15,m=v(),g=v(!1),p=v(!1),n=v(""),f=v(),$=[{key:"actions"}],E=[{key:"close_timestamp",label:"Close date"},{key:"exit_reason",label:"Close Reason"}],F=o=>I(o,t.activeBot.stakeCurrencyDecimals),x=R(()=>e.trades.length),A=[e.multiBotView?{key:"botName",label:"Bot"}:{},{key:"trade_id",label:"ID"},{key:"pair",label:"Pair"},{key:"amount",label:"Amount"},{key:"stake_amount",label:"Stake amount",formatter:o=>F(o)},{key:"open_rate",label:"Open rate",formatter:o=>I(o)},{key:e.activeTrades?"current_rate":"close_rate",label:e.activeTrades?"Current rate":"Close rate",formatter:o=>I(o)},{key:"profit",label:e.activeTrades?"Current profit %":"Profit %",formatter:(o,b,k)=>`${W(k.profit_ratio,2)} ${`(${F(k.profit_abs)})`}`},{key:"open_timestamp",label:"Open date"},...e.activeTrades?$:E],a=v(void 0),M=(o,b=void 0)=>{l.value=o,n.value=`Really exit trade ${o.trade_id} (Pair ${o.pair}) using ${b} Order?`,p.value=!0,a.value=b},O=()=>{if(n.value.includes("delete")){const b={tradeid:String(l.value.trade_id),botId:l.value.botId};t.deleteTradeMulti(b).catch(k=>console.log(k.response)),p.value=!1;return}console.log(n.value);const o={tradeid:String(l.value.trade_id),botId:l.value.botId};a.value&&(o.ordertype=a.value),t.forceSellMulti(o).then(b=>console.log(b)).catch(b=>console.log(b.response)),a.value=void 0,p.value=!1},N=o=>{n.value=`Really delete trade ${o.trade_id} (Pair ${o.pair})?`,l.value=o,p.value=!0},U=o=>{l.value=o,g.value=!0},q=(o,b,k)=>{!e.activeTrades||(k.preventDefault(),console.log(o))},K=o=>{o&&o.trade_id!==t.activeBot.detailTradeId?t.activeBot.setDetailTrade(o):t.activeBot.setDetailTrade(null)},Z=()=>{var o;if(t.activeBot.detailTradeId){const b=e.trades.findIndex(k=>k.trade_id===t.activeBot.detailTradeId);b>=0?(o=m.value)==null||o.selectRow(b):(console.log(`Unsetting item for tradeid ${y.value}`),y.value=void 0)}};return J(()=>t.activeBot.detailTradeId,o=>{var k;e.trades.findIndex(L=>L.trade_id===o)<0&&((k=m.value)==null||k.clearSelected())}),{botStore:t,currentPage:r,selectedItemIndex:y,filterText:_,perPage:u,tableFields:A,rows:x,tradesTable:m,forceExitHandler:M,forceExitPartialHandler:U,handleContextMenuEvent:q,removeTradeHandler:N,onRowClicked:K,onRowSelected:Z,feTrade:l,forceExitVisible:g,removeTradeVisible:p,confirmExitText:n,removeTradeModal:f,forceExitExecuter:O}}}),Ve={class:"h-100 overflow-auto w-100"},$e={class:"w-100 d-flex justify-content-between"};function Ce(e,t,r,y,_,l){const u=s("ActionIcon"),m=s("b-button"),g=s("trade-actions"),p=s("b-popover"),n=s("trade-profit"),f=s("DateTimeTZ"),$=s("b-table"),E=s("b-pagination"),F=s("b-form-input"),x=s("force-exit-form"),A=s("b-modal");return d(),w("div",Ve,[i($,{ref:"tradesTable",small:"",hover:"",stacked:"md",items:[...e.trades],fields:e.tableFields,"show-empty":"","empty-text":e.emptyText,"per-page":e.perPage,"current-page":e.currentPage,"primary-key":"botTradeId",selectable:"","select-mode":"single",filter:e.filterText,onRowContextmenu:e.handleContextMenuEvent,onRowClicked:e.onRowClicked,onRowSelected:e.onRowSelected},{"cell(actions)":c(a=>[i(m,{id:`btn-actions_${a.index}`,class:"btn-xs",size:"sm",title:"Actions",href:"#"},{default:c(()=>[i(u,{size:16,title:"Actions"})]),_:2},1032,["id"]),i(p,{target:`btn-actions_${a.index}`,title:`Actions for ${a.item.pair}`,triggers:"focus",placement:"left"},{default:c(()=>[i(g,{trade:a.item,"bot-api-version":e.botStore.activeBot.botApiVersion,onDeleteTrade:e.removeTradeHandler,onForceExit:e.forceExitHandler,onForceExitPartial:e.forceExitPartialHandler},null,8,["trade","bot-api-version","onDeleteTrade","onForceExit","onForceExitPartial"])]),_:2},1032,["target","title"])]),"cell(pair)":c(a=>[C("span",null,V(`${a.item.pair}${a.item.open_order_id===void 0||a.item.open_order_id===null?"":"*"}`),1)]),"cell(trade_id)":c(a=>[S(V(a.item.trade_id)+" "+V(e.botStore.activeBot.botApiVersion>2&&a.item.trading_mode!=="spot"?"| "+(a.item.is_short?"Short":"Long"):""),1)]),"cell(profit)":c(a=>[i(n,{trade:a.item},null,8,["trade"])]),"cell(open_timestamp)":c(a=>[i(f,{date:a.item.open_timestamp},null,8,["date"])]),"cell(close_timestamp)":c(a=>[i(f,{date:a.item.close_timestamp},null,8,["date"])]),_:1},8,["items","fields","empty-text","per-page","current-page","filter","onRowContextmenu","onRowClicked","onRowSelected"]),C("div",$e,[e.activeTrades?T("",!0):(d(),h(E,{key:0,modelValue:e.currentPage,"onUpdate:modelValue":t[0]||(t[0]=a=>e.currentPage=a),"total-rows":e.rows,"per-page":e.perPage,"aria-controls":"my-table"},null,8,["modelValue","total-rows","per-page"])),e.showFilter?(d(),h(F,{key:1,modelValue:e.filterText,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filterText=a),type:"text",placeholder:"Filter",size:"sm",style:{width:"unset"}},null,8,["modelValue"])):T("",!0)]),e.activeTrades?(d(),h(x,{key:0,modelValue:e.forceExitVisible,"onUpdate:modelValue":t[2]||(t[2]=a=>e.forceExitVisible=a),trade:e.feTrade},null,8,["modelValue","trade"])):T("",!0),i(A,{ref:"removeTradeModal",modelValue:e.removeTradeVisible,"onUpdate:modelValue":t[3]||(t[3]=a=>e.removeTradeVisible=a),title:"Exit trade",onOk:e.forceExitExecuter},{default:c(()=>[S(V(e.confirmExitText),1)]),_:1},8,["modelValue","onOk"])])}var Fe=B(Te,[["render",Ce],["__scopeId","data-v-2788dd9e"]]);export{ie as F,Fe as T};
//# sourceMappingURL=TradeList.8ad54ef3.js.map
