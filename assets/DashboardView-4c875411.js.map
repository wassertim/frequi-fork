{"version":3,"file":"DashboardView-4c875411.js","sources":["../../src/components/ftbot/BotComparisonList.vue","../../src/views/DashboardView.vue"],"sourcesContent":["<template>\n  <b-table\n    ref=\"tradesTable\"\n    small\n    hover\n    show-empty\n    primary-key=\"botId\"\n    :items=\"tableItems\"\n    :fields=\"tableFields\"\n  >\n    <template #cell(botName)=\"{ item, value }\">\n      <div class=\"d-flex flex-row\">\n        <b-form-checkbox\n          v-if=\"item.botId && botStore.botCount > 1\"\n          v-model=\"\n            botStore.botStores[(item as unknown as ComparisonTableItems).botId ?? ''].isSelected\n          \"\n          title=\"Show this bot in Dashboard\"\n          >{{ value }}</b-form-checkbox\n        >\n        <b-form-checkbox\n          v-if=\"!item.botId && botStore.botCount > 1\"\n          v-model=\"allToggled\"\n          title=\"Toggle all bots\"\n          >{{ value }}</b-form-checkbox\n        >\n        <span v-if=\"botStore.botCount <= 1\">{{ value }}</span>\n      </div>\n    </template>\n    <template #cell(profitOpen)=\"{ item }\">\n      <profit-pill\n        v-if=\"item.profitOpen && item.botId != 'Summary'\"\n        :profit-ratio=\"(item as unknown as ComparisonTableItems).profitOpenRatio\"\n        :profit-abs=\"(item as unknown as ComparisonTableItems).profitOpen\"\n        :stake-currency=\"(item as unknown as ComparisonTableItems).stakeCurrency\"\n      />\n    </template>\n    <template #cell(profitClosed)=\"{ item }\">\n      <profit-pill\n        v-if=\"item.profitClosed && item.botId != 'Summary'\"\n        :profit-ratio=\"(item as unknown as ComparisonTableItems).profitClosedRatio\"\n        :profit-abs=\"(item as unknown as ComparisonTableItems).profitClosed\"\n        :stake-currency=\"(item as unknown as ComparisonTableItems).stakeCurrency\"\n      />\n    </template>\n\n    <template #cell(balance)=\"{ item }\">\n      <div v-if=\"item.balance\">\n        <span :title=\"(item as unknown as ComparisonTableItems).stakeCurrency\"\n          >{{\n            formatPrice(\n              (item as unknown as ComparisonTableItems).balance ?? 0,\n              (item as unknown as ComparisonTableItems).stakeCurrencyDecimals,\n            )\n          }}\n        </span>\n        <span class=\"text-small\">{{\n          ` ${item.stakeCurrency}${item.isDryRun ? ' (dry)' : ''}`\n        }}</span>\n      </div>\n    </template>\n    <template #cell(winVsLoss)=\"{ item }\">\n      <div v-if=\"item.losses !== undefined\">\n        <span class=\"text-profit\">{{ item.wins }}</span> /\n        <span class=\"text-loss\">{{ item.losses }}</span>\n      </div>\n    </template>\n  </b-table>\n</template>\n\n<script setup lang=\"ts\">\nimport { formatPrice } from '@/shared/formatters';\nimport { computed } from 'vue';\nimport { useBotStore } from '@/stores/ftbotwrapper';\nimport { ProfitInterface, ComparisonTableItems } from '@/types';\nimport { TableField, TableItem } from 'bootstrap-vue-next';\n\nconst sortFunction = (a: ComparisonTableItems, b: ComparisonTableItems) => {\n  if (!a.profitClosed || !b.profitClosed) return -1;\n  return a.profitClosed - b.profitClosed;\n};\n\nconst botStore = useBotStore();\n\nconst allToggled = computed<boolean>({\n  get: () => Object.values(botStore.botStores).every((i) => i.isSelected),\n  set: (val) => {\n    for (const botId in botStore.botStores) {\n      botStore.botStores[botId].isSelected = val;\n    }\n  },\n});\n\nconst tableFields: TableField[] = [\n  { key: 'botName', label: 'Bot' },\n  { key: 'trades', label: 'Trades' },\n  { key: 'profitOpen', label: 'Open Profit' },\n  { key: 'profitClosed', label: 'Closed Profit' },\n  { key: 'balance', label: 'Balance' },\n  { key: 'winVsLoss', label: 'W/L' },\n];\n\nconst tableItems = computed<TableItem[]>(() => {\n  const val: ComparisonTableItems[] = [];\n  const summary: ComparisonTableItems = {\n    botId: undefined,\n    botName: 'Summary',\n    profitClosed: 0,\n    profitClosedRatio: undefined,\n    profitOpen: 0,\n    profitOpenRatio: undefined,\n    stakeCurrency: 'USDT',\n    wins: 0,\n    losses: 0,\n  };\n\n  Object.entries(botStore.allProfit).forEach(([k, v]: [k: string, v: ProfitInterface]) => {\n    const allStakes = botStore.allOpenTrades[k].reduce((a, b) => a + b.stake_amount, 0);\n    const profitOpenRatio =\n      botStore.allOpenTrades[k].reduce(\n        (a, b) => a + (b.total_profit_ratio ?? b.profit_ratio) * b.stake_amount,\n        0,\n      ) / allStakes;\n    const profitOpen = botStore.allOpenTrades[k].reduce(\n      (a, b) => a + (b.total_profit_abs ?? b.profit_abs ?? 0),\n      0,\n    );\n\n    // TODO: handle one inactive bot ...\n    val.push({\n      botId: k,\n      botName: botStore.availableBots[k].botName || botStore.availableBots[k].botId,\n      trades: `${botStore.allOpenTradeCount[k]} / ${\n        botStore.allBotState[k]?.max_open_trades || 'N/A'\n      }`,\n      profitClosed: v.profit_closed_coin,\n      profitClosedRatio: v.profit_closed_ratio || 0,\n      stakeCurrency: botStore.allBotState[k]?.stake_currency || '',\n      profitOpenRatio,\n      profitOpen,\n      wins: v.winning_trades,\n      losses: v.losing_trades,\n      balance: botStore.allBalance[k]?.total_bot ?? botStore.allBalance[k]?.total,\n      stakeCurrencyDecimals: botStore.allBotState[k]?.stake_currency_decimals || 3,\n      isDryRun: botStore.allBotState[k]?.dry_run,\n    });\n    if (v.profit_closed_coin !== undefined) {\n      if (botStore.botStores[k].isSelected) {\n        // Summary should only include selected bots\n        summary.profitClosed += v.profit_closed_coin;\n        summary.profitOpen += profitOpen;\n        summary.wins += v.winning_trades;\n        summary.losses += v.losing_trades;\n        // summary.decimals = this.allBotState[k]?.stake_currency_decimals || summary.decimals;\n        // This will always take the last bot's stake currency\n        // And therefore may result in wrong values.\n        summary.stakeCurrency = botStore.allBotState[k]?.stake_currency || summary.stakeCurrency;\n      }\n    }\n  });\n  val.sort(sortFunction);\n  val.push(summary);\n  return val as unknown as TableItem[];\n});\n</script>\n\n<style scoped></style>\n","<template>\n  <grid-layout\n    class=\"h-100 w-100\"\n    :row-height=\"50\"\n    :layout=\"gridLayoutData\"\n    :vertical-compact=\"false\"\n    :margin=\"[5, 5]\"\n    :responsive-layouts=\"responsiveGridLayouts\"\n    :is-resizable=\"!isLayoutLocked\"\n    :is-draggable=\"!isLayoutLocked\"\n    :responsive=\"true\"\n    :prevent-collision=\"true\"\n    :cols=\"{ lg: 12, md: 12, sm: 12, xs: 4, xxs: 2 }\"\n    :col-num=\"12\"\n    @layout-updated=\"layoutUpdatedEvent\"\n    @update:breakpoint=\"breakpointChanged\"\n  >\n    <template #default=\"{ gridItemProps }\">\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutDaily.i\"\n        :x=\"gridLayoutDaily.x\"\n        :y=\"gridLayoutDaily.y\"\n        :w=\"gridLayoutDaily.w\"\n        :h=\"gridLayoutDaily.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer :header=\"`Daily Profit ${botStore.botCount > 1 ? 'combined' : ''}`\">\n          <TimePeriodChart\n            v-if=\"botStore.allDailyStatsSelectedBots\"\n            :daily-stats=\"botStore.allDailyStatsSelectedBots\"\n            :show-title=\"false\"\n          />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutBotComparison.i\"\n        :x=\"gridLayoutBotComparison.x\"\n        :y=\"gridLayoutBotComparison.y\"\n        :w=\"gridLayoutBotComparison.w\"\n        :h=\"gridLayoutBotComparison.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer header=\"Bot comparison\">\n          <bot-comparison-list />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutAllOpenTrades.i\"\n        :x=\"gridLayoutAllOpenTrades.x\"\n        :y=\"gridLayoutAllOpenTrades.y\"\n        :w=\"gridLayoutAllOpenTrades.w\"\n        :h=\"gridLayoutAllOpenTrades.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer>\n          <template #header>\n            <div class=\"d-flex justify-content-center\">\n              Open Trades\n              <InfoBox\n                class=\"ms-2\"\n                hint=\"Open trades of all selected bots. Click on a trade to go to the trade page for that trade/bot.\"\n              />\n            </div>\n          </template>\n          <trade-list active-trades :trades=\"botStore.allOpenTradesSelectedBots\" multi-bot-view />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutCumChart.i\"\n        :x=\"gridLayoutCumChart.x\"\n        :y=\"gridLayoutCumChart.y\"\n        :w=\"gridLayoutCumChart.w\"\n        :h=\"gridLayoutCumChart.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer header=\"Cumulative Profit\">\n          <CumProfitChart\n            :trades=\"botStore.allTradesSelectedBots\"\n            :open-trades=\"botStore.allOpenTradesSelectedBots\"\n            :show-title=\"false\"\n          />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutAllClosedTrades.i\"\n        :x=\"gridLayoutAllClosedTrades.x\"\n        :y=\"gridLayoutAllClosedTrades.y\"\n        :w=\"gridLayoutAllClosedTrades.w\"\n        :h=\"gridLayoutAllClosedTrades.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer>\n          <template #header>\n            <div class=\"d-flex justify-content-center\">\n              Closed Trades\n              <InfoBox\n                class=\"ms-2\"\n                hint=\"Closed trades for all selected bots. Click on a trade to go to the trade page for that trade/bot.\"\n              />\n            </div>\n          </template>\n          <trade-list\n            :active-trades=\"false\"\n            show-filter\n            :trades=\"botStore.allClosedTradesSelectedBots\"\n            multi-bot-view\n          />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutProfitDistribution.i\"\n        :x=\"gridLayoutProfitDistribution.x\"\n        :y=\"gridLayoutProfitDistribution.y\"\n        :w=\"gridLayoutProfitDistribution.w\"\n        :h=\"gridLayoutProfitDistribution.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer header=\"Profit Distribution\">\n          <ProfitDistributionChart :trades=\"botStore.allTradesSelectedBots\" :show-title=\"false\" />\n        </DraggableContainer>\n      </grid-item>\n      <grid-item\n        v-bind=\"gridItemProps\"\n        :i=\"gridLayoutTradesLogChart.i\"\n        :x=\"gridLayoutTradesLogChart.x\"\n        :y=\"gridLayoutTradesLogChart.y\"\n        :w=\"gridLayoutTradesLogChart.w\"\n        :h=\"gridLayoutTradesLogChart.h\"\n        :min-w=\"3\"\n        :min-h=\"4\"\n        drag-allow-from=\".drag-header\"\n      >\n        <DraggableContainer header=\"Trades Log\">\n          <TradesLogChart :trades=\"botStore.allTradesSelectedBots\" :show-title=\"false\" />\n        </DraggableContainer>\n      </grid-item>\n    </template>\n  </grid-layout>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue';\n\nimport { DashboardLayout, findGridLayout, useLayoutStore } from '@/stores/layout';\nimport { useBotStore } from '@/stores/ftbotwrapper';\nimport { GridItemData } from '@/types';\n\nconst botStore = useBotStore();\n\nconst layoutStore = useLayoutStore();\nconst currentBreakpoint = ref('');\n\nconst breakpointChanged = (newBreakpoint: string) => {\n  // console.log('breakpoint:', newBreakpoint);\n  currentBreakpoint.value = newBreakpoint;\n};\nconst isResizableLayout = computed(() =>\n  ['', 'sm', 'md', 'lg', 'xl'].includes(currentBreakpoint.value),\n);\nconst isLayoutLocked = computed(() => {\n  return layoutStore.layoutLocked || !isResizableLayout.value;\n});\n\nconst gridLayoutData = computed((): GridItemData[] => {\n  if (isResizableLayout.value) {\n    return layoutStore.dashboardLayout;\n  }\n  return [...layoutStore.getDashboardLayoutSm];\n});\n\nconst layoutUpdatedEvent = (newLayout) => {\n  if (isResizableLayout.value) {\n    console.log('newlayout', newLayout);\n    console.log('saving dashboard');\n    layoutStore.dashboardLayout = newLayout;\n  }\n};\n\nconst gridLayoutDaily = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.dailyChart);\n});\n\nconst gridLayoutBotComparison = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.botComparison);\n});\n\nconst gridLayoutAllOpenTrades = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.allOpenTrades);\n});\nconst gridLayoutAllClosedTrades = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.allClosedTrades);\n});\n\nconst gridLayoutCumChart = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.cumChartChart);\n});\nconst gridLayoutProfitDistribution = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.profitDistributionChart);\n});\nconst gridLayoutTradesLogChart = computed((): GridItemData => {\n  return findGridLayout(gridLayoutData.value, DashboardLayout.tradesLogChart);\n});\n\nconst responsiveGridLayouts = computed(() => {\n  return {\n    sm: layoutStore.getDashboardLayoutSm,\n  };\n});\n\nonMounted(async () => {\n  botStore.allGetDaily({ timescale: 30 });\n  // botStore.activeBot.getTrades();\n  botStore.activeBot.getOpenTrades();\n  botStore.activeBot.getProfit();\n});\n</script>\n\n<style scoped></style>\n"],"names":["sortFunction","a","b","botStore","useBotStore","allToggled","computed","val","botId","tableFields","tableItems","summary","k","v","allStakes","profitOpenRatio","profitOpen","_a","_b","_c","_d","_e","_f","_g","layoutStore","useLayoutStore","currentBreakpoint","ref","breakpointChanged","newBreakpoint","isResizableLayout","isLayoutLocked","gridLayoutData","layoutUpdatedEvent","newLayout","gridLayoutDaily","findGridLayout","DashboardLayout","gridLayoutBotComparison","gridLayoutAllOpenTrades","gridLayoutAllClosedTrades","gridLayoutCumChart","gridLayoutProfitDistribution","gridLayoutTradesLogChart","responsiveGridLayouts","onMounted"],"mappings":"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"}