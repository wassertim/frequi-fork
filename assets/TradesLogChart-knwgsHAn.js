import{g as P,aA as v,k as y,o as x,c as U,a as Z,x as w,h as _,z as $,b as V,w as E,U as W,a3 as J,G as K,_ as k,aP as j,r as Q,n as X,aV as Y,V as tt,l as G,aC as et,t as ot}from"./index-5184G5jG.js";import{u as O,be as L,ba as S,bb as A,bc as B,bd as I,bf as z}from"./installCanvasRenderer--0m70W6g.js";import{k as M,f as D,l as H,g as at,m as q,h as st,j as rt}from"./install-r6n5kKCv.js";function nt(i,t){const n=Math.min(...i),c=(Math.max(...i)-n)*1.01/t,f=[...Array(t).keys()].map(r=>[Math.round((n+r*c)*1e3)/1e3,0]);for(let r=0;r<i.length;r++){const a=Math.min(Math.floor((i[r]-n)/c),t-1);isNaN(a)||f[a][1]++}return f}const it={class:"d-flex flex-column h-100 position-relative"},lt={class:"flex-grow-1"},T="Trade count",ct=P({__name:"ProfitDistributionChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(i){O([M,L,S,D,A,B,I]);const t=i,n=v(),b=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],c=y(()=>{const r=t.trades.map(a=>a.profit_ratio);return nt(r,n.profitDistributionBins)}),f=y(()=>({title:{text:"Profit distribution",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:c.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[T],right:"5%",selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:T,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],series:[{type:"bar",name:T,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(r,a)=>{const l=J,g=K;return x(),U("div",it,[Z("div",lt,[i.trades?(x(),w(_(z),{key:0,option:_(f),autoresize:"",theme:_(n).chartTheme},null,8,["option","theme"])):$("",!0)]),V(g,{class:W(["z-2",i.showTitle?"ms-5 ps-5":"position-absolute"]),label:"Bins",style:{width:"33%","min-width":"12rem"},"label-for":"input-bins","label-cols":"6","content-cols":"6",size:"sm"},{default:E(()=>[V(l,{id:"input-bins",modelValue:_(n).profitDistributionBins,"onUpdate:modelValue":a[0]||(a[0]=e=>_(n).profitDistributionBins=e),size:"sm",class:"mt-1",options:b},null,8,["modelValue"])]),_:1},8,["class"])])}}}),_t=k(ct,[["__scopeId","data-v-2a4f5beb"]]),C="Profit",ut=P({__name:"CumProfitChart",props:{trades:{required:!0,type:Array},openTrades:{required:!1,type:Array,default:()=>[]},showTitle:{default:!0,type:Boolean},profitColumn:{default:"profit_abs",type:String}},setup(i){O([M,H,L,S,D,at,A,B,I]);const t=i,n=v(),b=j(),c=Q(),f=y(()=>t.openTrades.reduce((e,s)=>e+(s.total_profit_abs??s[t.profitColumn]??0),0)),r=y(()=>{const e=[],s={},p=t.trades.slice().sort((u,m)=>u.close_timestamp>m.close_timestamp?1:-1);let h=0;for(let u=0,m=p.length;u<m;u+=1){const o=p[u];o.close_timestamp&&o[t.profitColumn]&&(h+=o[t.profitColumn],s[o.close_timestamp]?(s[o.close_timestamp].profit+=o[t.profitColumn],s[o.close_timestamp][o.botId]?s[o.close_timestamp][o.botId]+=o[t.profitColumn]:s[o.close_timestamp][o.botId]=h):s[o.close_timestamp]={profit:h,[o.botId]:h},e.push({date:o.close_timestamp,profit:h,[o.botId]:h}))}const d=Object.entries(s).map(([u,m])=>({date:parseInt(u,10),profit:m.profit}));if(t.openTrades.length>0){let u=0,m=0;if(d.length>0){const R=d[d.length-1];u=R.profit??0,m=R.date??0}else m=t.openTrades[0].open_timestamp;const o=(u??0)+f.value;d.push({date:m,currentProfit:u});const F=Date.now()+24*60*60*1e3;d.push({date:F,currentProfit:o})}return d});function a(e=!1){const{colorProfit:s,colorLoss:p}=b;return{dataset:{dimensions:["date","profit","currentProfit"],source:r.value},series:[{type:"line",name:"currentProfit",animation:e,lineStyle:{color:f.value>0?s:p,type:"dotted"},itemStyle:{color:f.value>0?s:p},encode:{x:"date",y:"currentProfit"}},{type:"line",name:C,animation:e,step:"end",lineStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function l(e=!1){var p;const s=a(e);(p=c.value)==null||p.setOption(s,{replaceMerge:["series","dataset"]})}function g(){var p,h;(p=c.value)==null||p.setOption({},{notMerge:!0});const e={title:{text:"Cumulative Profit",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:d=>{const u=d[0].data.profit,m=d[0].data.currentProfit,o=m?`Projected profit (incl. unrealized): ${G(m,3)}`:`Profit: ${G(u,3)}`;return`${et(d[1].data.date)}<br />${d[1].marker}${o}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[C],right:"5%",selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:C,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{bottom:80},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...q}]},s=a(!0);e.series=s.series,e.dataset=s.dataset,(h=c.value)==null||h.setOption(e,{notMerge:!0}),l(!0)}return X(()=>{g()}),Y(()=>t.openTrades,()=>{l()},{throttle:60*1e3}),tt(()=>t.trades,()=>{l()}),(e,s)=>i.trades?(x(),w(_(z),{key:0,ref_key:"chart",ref:c,autoresize:"","manual-update":"",theme:_(n).chartTheme},null,8,["theme"])):$("",!0)}}),bt=k(ut,[["__scopeId","data-v-eaa1fa4b"]]),N="Profit %",mt="#9be0a8",pt=P({__name:"TradesLogChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(i){O([M,H,L,S,D,A,B,I,st,rt]);const t=i,n=v(),b=j(),c=y(()=>{const r=[],a=t.trades.slice(0).sort((l,g)=>l.close_timestamp>g.close_timestamp?1:-1);for(let l=0,g=a.length;l<g;l+=1){const e=a[l],s=[l,(e.profit_ratio*100).toFixed(2),e.pair,e.botName,ot(e.close_timestamp),e.is_short===void 0||!e.is_short?"Long":"Short"];r.push(s)}return r}),f=y(()=>{const r=c.value.length>0?(1-50/c.value.length)*100:100;return{title:{text:"Trades log",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:c.value},tooltip:{trigger:"axis",formatter:a=>{const l=a[0].data[3]?` | ${a[0].data[3]}`:"";return`${a[0].data[2]} | ${a[0].data[5]} ${l}<br>${a[0].data[4]}<br>Profit ${a[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"value",show:!1},yAxis:[{type:"value",name:N,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{bottom:80},dataZoom:[{type:"inside",start:r,end:100},{bottom:10,start:r,end:100,...q}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:b.colorLoss},{min:0,color:b.colorProfit}]}],series:[{type:"bar",name:N,barGap:"0%",barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:n.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:mt}}]}});return(r,a)=>i.trades.length>0?(x(),w(_(z),{key:0,option:_(f),autoresize:"",theme:_(n).chartTheme},null,8,["option","theme"])):$("",!0)}}),gt=k(pt,[["__scopeId","data-v-ea79394f"]]);export{gt as _,bt as a,_t as b};
//# sourceMappingURL=TradesLogChart-knwgsHAn.js.map
